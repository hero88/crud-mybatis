<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reset Your Password</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>

<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<div class="form-gap"></div>
<div class="container">
    <div class="row">
        <div class="col-md-4 col-md-offset-4" style="padding-top: 70px;">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="text-center">
                        <h3><i class="fa fa-lock fa-4x"></i></h3>
                        <h2 class="text-center">Reset Your Password</h2>
                        <p>You can reset your password here.</p>
                        <div class="panel-body">

                            <form id="form_reset_password" th:action="@{/reset_password}" method="post" style="max-width: 350px; margin: 0 auto;">
                                <input type="hidden" name="token" th:value="${token}" />
                                <div class="border border-secondary rounded p-3">
                                    <div>
                                        <p>
                                            <input type="password" name="password" id="password" class="form-control"
                                                   placeholder="Enter your new password" required autofocus />
                                        </p>
                                        <p>
                                            <input type="password" class="form-control" placeholder="Confirm your new password"
                                                   required oninput="checkPasswordMatch(this);" />
                                        </p>
                                        <p class="text-center">
                                            <input type="submit" value="Change Password" class="btn btn-primary" />
                                        </p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!--<form id="form_reset_password" th:action="@{/reset_password}" method="post" style="max-width: 350px; margin: 0 auto;">-->
<!--    <input type="hidden" name="token" th:value="${token}" />-->
<!--    <div class="border border-secondary rounded p-3">-->
<!--        <div>-->
<!--            <p>-->
<!--                <input type="password" name="password" id="password" class="form-control"-->
<!--                       placeholder="Enter your new password" required autofocus />-->
<!--            </p>-->
<!--            <p>-->
<!--                <input type="password" class="form-control" placeholder="Confirm your new password"-->
<!--                       required oninput="checkPasswordMatch(this);" />-->
<!--            </p>-->
<!--            <p class="text-center">-->
<!--                <input type="submit" value="Change Password" class="btn btn-primary" />-->
<!--            </p>-->
<!--        </div>-->
<!--    </div>-->
<!--</form>-->
    <script src="../js/main.js"></script>

<script>
    function checkPasswordMatch(fieldConfirmPassword) {
        if (fieldConfirmPassword.value != $("#password").val()) {
            fieldConfirmPassword.setCustomValidity("Passwords do not match!");
        } else {
            fieldConfirmPassword.setCustomValidity("");
        }
    }

    $("#form_reset_password").on("submit", function (e){
        e.preventDefault();
        loginFunction();
    });

    function loginFunction() {
        "use strict";
        let searchParams = new URLSearchParams(window.location.search)
        let param = searchParams.get('token')

        const vLoginData = {
            password: $("#password").val(),
            token: param
        };

        $.ajax({
            url: "http://localhost:8080/api/auth/reset_password",
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            data: JSON.stringify(vLoginData),
            success: function (res) {
                window.location.href = "../auth/login.html";
            },
            error: function (err) {
                alert("Nhập tối thiểu 6 kí tự");
                console.log(err.responseText);
            }
        });
    }
</script>

</body>
</html>

